# yaml-language-server: $schema=./schema.json

task_definitions:
  - id: SecondsInSystemClock
    name: ShowSecondsInSystemClock
    description: Show seconds on the taskbar clock
    script:
      apply: |-
        function SecondsInSystemClock
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Show"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowSecondsInSystemClock -PropertyType DWord -Value 1 -Force
                }
                "Hide"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowSecondsInSystemClock -PropertyType DWord -Value 0 -Force
                }
            }
        }
        SecondsInSystemClock -Show
      revert: |-
        function SecondsInSystemClock
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Show"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowSecondsInSystemClock -PropertyType DWord -Value 1 -Force
                }
                "Hide"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowSecondsInSystemClock -PropertyType DWord -Value 0 -Force
                }
            }
        }
        SecondsInSystemClock -Hide
  - id: ClockInNotificationCenter
    name: ShowClockInNotificationCenter
    description: Show time in Notification Center
    script:
      apply: |-
        function ClockInNotificationCenter
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide
            )

            if ((Get-CimInstance -ClassName CIM_OperatingSystem).BuildNumber -lt 26200)
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            switch ($PSCmdlet.ParameterSetName)
            {
                "Show"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowClockInNotificationCenter -PropertyType DWord -Value 1 -Force
                }
                "Hide"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowClockInNotificationCenter -PropertyType DWord -Value 0 -Force
                }
            }
        }
        ClockInNotificationCenter -Show
      revert: |-
        function ClockInNotificationCenter
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide
            )

            if ((Get-CimInstance -ClassName CIM_OperatingSystem).BuildNumber -lt 26200)
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            switch ($PSCmdlet.ParameterSetName)
            {
                "Show"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowClockInNotificationCenter -PropertyType DWord -Value 1 -Force
                }
                "Hide"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowClockInNotificationCenter -PropertyType DWord -Value 0 -Force
                }
            }
        }
        ClockInNotificationCenter -Hide
  - id: WindowsColorMode
    name: DarkWindowsColorMode
    description: Set the default Windows mode to dark
    script:
      apply: |-
        function WindowsColorMode
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Dark"
                )]
                [switch]
                $Dark,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Light"
                )]
                [switch]
                $Light
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Dark"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name SystemUsesLightTheme -PropertyType DWord -Value 0 -Force
                }
                "Light"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name SystemUsesLightTheme -PropertyType DWord -Value 1 -Force
                }
            }
        }
        WindowsColorMode -Dark
      revert: |-
        function WindowsColorMode
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Dark"
                )]
                [switch]
                $Dark,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Light"
                )]
                [switch]
                $Light
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Dark"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name SystemUsesLightTheme -PropertyType DWord -Value 0 -Force
                }
                "Light"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name SystemUsesLightTheme -PropertyType DWord -Value 1 -Force
                }
            }
        }
        WindowsColorMode -Light
  - id: AppColorMode
    name: DarkAppColorMode
    description: Set the default app mode to dark
    script:
      apply: |-
        function AppColorMode
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Dark"
                )]
                [switch]
                $Dark,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Light"
                )]
                [switch]
                $Light
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Dark"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name AppsUseLightTheme -PropertyType DWord -Value 0 -Force
                }
                "Light"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name AppsUseLightTheme -PropertyType DWord -Value 1 -Force
                }
            }
        }
        AppColorMode -Dark
      revert: |-
        function AppColorMode
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Dark"
                )]
                [switch]
                $Dark,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Light"
                )]
                [switch]
                $Light
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Dark"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name AppsUseLightTheme -PropertyType DWord -Value 0 -Force
                }
                "Light"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize -Name AppsUseLightTheme -PropertyType DWord -Value 1 -Force
                }
            }
        }
        AppColorMode -Light
  - id: ShortcutsSuffix
    name: DisableShortcutsSuffix
    description: Do not add the "- Shortcut" suffix to the file name of created shortcuts
    script:
      apply: |-
        function ShortcutsSuffix
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable
            )

            Remove-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer -Name link -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Disable"
                {
                    if (-not (Test-Path -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates))
                    {
                        New-Item -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates -Force
                    }
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates -Name ShortcutNameTemplate -PropertyType String -Value "%s.lnk" -Force
                }
                "Enable"
                {
                    Remove-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates -Name ShortcutNameTemplate -Force -ErrorAction Ignore
                }
            }
        }
        ShortcutsSuffix -Disable
      revert: |-
        function ShortcutsSuffix
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable
            )

            Remove-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer -Name link -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Disable"
                {
                    if (-not (Test-Path -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates))
                    {
                        New-Item -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates -Force
                    }
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates -Name ShortcutNameTemplate -PropertyType String -Value "%s.lnk" -Force
                }
                "Enable"
                {
                    Remove-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\NamingTemplates -Name ShortcutNameTemplate -Force -ErrorAction Ignore
                }
            }
        }
        ShortcutsSuffix -Enable
  - id: FolderGroupBy
    name: NoneFolderGroupBy
    description: Do not group files and folder in the Downloads folder
    script:
      apply: |-
        function FolderGroupBy
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "None"
                )]
                [switch]
                $None,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Default"
                )]
                [switch]
                $Default
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "None"
                {
                    # Clear any Common Dialog views
                    Get-ChildItem -Path "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\Bags\*\Shell" -Recurse | Where-Object -FilterScript {$_.PSChildName -eq "{885A186E-A440-4ADA-812B-DB871B942259}"} | Remove-Item -Force

                    # https://learn.microsoft.com/en-us/windows/win32/properties/props-system-null
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name ColumnList -PropertyType String -Value "System.Null" -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name GroupBy -PropertyType String -Value "System.Null" -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name LogicalViewMode -PropertyType DWord -Value 1 -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name Name -PropertyType String -Value NoName -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name Order -PropertyType DWord -Value 0 -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name PrimaryProperty -PropertyType String -Value "System.ItemNameDisplay" -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name SortByList -PropertyType String -Value "prop:System.ItemNameDisplay" -Force
                }
                "Default"
                {
                    Remove-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}" -Recurse -Force -ErrorAction Ignore
                }
            }
        }
        FolderGroupBy -None
      revert: |-
        function FolderGroupBy
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "None"
                )]
                [switch]
                $None,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Default"
                )]
                [switch]
                $Default
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "None"
                {
                    # Clear any Common Dialog views
                    Get-ChildItem -Path "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\Bags\*\Shell" -Recurse | Where-Object -FilterScript {$_.PSChildName -eq "{885A186E-A440-4ADA-812B-DB871B942259}"} | Remove-Item -Force

                    # https://learn.microsoft.com/en-us/windows/win32/properties/props-system-null
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name ColumnList -PropertyType String -Value "System.Null" -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name GroupBy -PropertyType String -Value "System.Null" -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name LogicalViewMode -PropertyType DWord -Value 1 -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name Name -PropertyType String -Value NoName -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name Order -PropertyType DWord -Value 0 -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name PrimaryProperty -PropertyType String -Value "System.ItemNameDisplay" -Force
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}\TopViews\{00000000-0000-0000-0000-000000000000}" -Name SortByList -PropertyType String -Value "prop:System.ItemNameDisplay" -Force
                }
                "Default"
                {
                    Remove-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\FolderTypes\{885a186e-a440-4ada-812b-db871b942259}" -Recurse -Force -ErrorAction Ignore
                }
            }
        }
        FolderGroupBy -Default
  - id: RestorePreviousFolders
    name: EnableRestorePreviousFolders
    description: Restore previous folder windows at logon
    script:
      apply: |-
        function RestorePreviousFolders
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Disable"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name PersistBrowsers -PropertyType DWord -Value 0 -Force
                }
                "Enable"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name PersistBrowsers -PropertyType DWord -Value 1 -Force
                }
            }
        }
        RestorePreviousFolders -Enable
      revert: |-
        function RestorePreviousFolders
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Disable"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name PersistBrowsers -PropertyType DWord -Value 0 -Force
                }
                "Enable"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name PersistBrowsers -PropertyType DWord -Value 1 -Force
                }
            }
        }
        RestorePreviousFolders -Disable
  - id: EditWithClipchampContext
    name: HideEditWithClipchampContext
    description: Hide the "Edit with Clipchamp" item from the media files context menu
    script:
      apply: |-
        function EditWithClipchampContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            if (-not (Get-AppxPackage -Name Clipchamp.Clipchamp))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{8AB635F8-9A67-4698-AB99-784AD929F3B4}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{8AB635F8-9A67-4698-AB99-784AD929F3B4}" -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{8AB635F8-9A67-4698-AB99-784AD929F3B4}" -Force -ErrorAction Ignore
                }
            }
        }
        EditWithClipchampContext -Hide
      revert: |-
        function EditWithClipchampContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            if (-not (Get-AppxPackage -Name Clipchamp.Clipchamp))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{8AB635F8-9A67-4698-AB99-784AD929F3B4}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{8AB635F8-9A67-4698-AB99-784AD929F3B4}" -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{8AB635F8-9A67-4698-AB99-784AD929F3B4}" -Force -ErrorAction Ignore
                }
            }
        }
        EditWithClipchampContext -Show
  - id: EditWithPhotosContext
    name: HideEditWithPhotosContext
    description: Hide the "Edit with Photos" item from the media files context menu
    script:
      apply: |-
        function EditWithPhotosContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            if (-not (Get-AppxPackage -Name Microsoft.Windows.Photos))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{BFE0E2A4-C70C-4AD7-AC3D-10D1ECEBB5B4}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{BFE0E2A4-C70C-4AD7-AC3D-10D1ECEBB5B4}" -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{BFE0E2A4-C70C-4AD7-AC3D-10D1ECEBB5B4}" -Force -ErrorAction Ignore
                }
            }
        }
        EditWithPhotosContext -Hide
      revert: |-
        function EditWithPhotosContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            if (-not (Get-AppxPackage -Name Microsoft.Windows.Photos))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{BFE0E2A4-C70C-4AD7-AC3D-10D1ECEBB5B4}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{BFE0E2A4-C70C-4AD7-AC3D-10D1ECEBB5B4}" -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{BFE0E2A4-C70C-4AD7-AC3D-10D1ECEBB5B4}" -Force -ErrorAction Ignore
                }
            }
        }
        EditWithPhotosContext -Show
  - id: EditWithPaintContext
    name: HideEditWithPaintContext
    description: Hide the "Edit with Paint" item from the media files context menu
    script:
      apply: |-
        function EditWithPaintContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            if (-not (Get-AppxPackage -Name Microsoft.Paint))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{2430F218-B743-4FD6-97BF-5C76541B4AE9}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{2430F218-B743-4FD6-97BF-5C76541B4AE9}" -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{2430F218-B743-4FD6-97BF-5C76541B4AE9}" -Force -ErrorAction Ignore
                }
            }
        }
        EditWithPaintContext -Hide
      revert: |-
        function EditWithPaintContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            if (-not (Get-AppxPackage -Name Microsoft.Paint))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{2430F218-B743-4FD6-97BF-5C76541B4AE9}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{2430F218-B743-4FD6-97BF-5C76541B4AE9}" -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{2430F218-B743-4FD6-97BF-5C76541B4AE9}" -Force -ErrorAction Ignore
                }
            }
        }
        EditWithPaintContext -Show
  - id: PrintCMDContext
    name: HidePrintCmdContext
    description: Hide the "Print" item from the .bat and .cmd context menu
    script:
      apply: |-
        function PrintCMDContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\batfile\shell\print -Name ProgrammaticAccessOnly -PropertyType String -Value "" -Force
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\cmdfile\shell\print -Name ProgrammaticAccessOnly -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\batfile\shell\print, Registry::HKEY_CLASSES_ROOT\cmdfile\shell\print -Name ProgrammaticAccessOnly -Force -ErrorAction Ignore
                }
            }
        }
        PrintCMDContext -Hide
      revert: |-
        function PrintCMDContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\batfile\shell\print -Name ProgrammaticAccessOnly -PropertyType String -Value "" -Force
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\cmdfile\shell\print -Name ProgrammaticAccessOnly -PropertyType String -Value "" -Force
                }
                "Show"
                {
                    Remove-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\batfile\shell\print, Registry::HKEY_CLASSES_ROOT\cmdfile\shell\print -Name ProgrammaticAccessOnly -Force -ErrorAction Ignore
                }
            }
        }
        PrintCMDContext -Show
  - id: CompressedFolderNewContext
    name: HideCompressedFolderNewContext
    description: Hide the "Compressed (zipped) Folder" item from the "New" context menu
    script:
      apply: |-
        function CompressedFolderNewContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    Remove-Item -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Force -ErrorAction Ignore
                }
                "Show"
                {
                    if (-not (Test-Path -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew))
                    {
                        New-Item -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Force
                    }
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Name Data -PropertyType Binary -Value ([byte[]](80,75,5,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)) -Force
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Name ItemName -PropertyType ExpandString -Value "@%SystemRoot%\System32\zipfldr.dll,-10194" -Force
                }
            }
        }
        CompressedFolderNewContext -Hide
      revert: |-
        function CompressedFolderNewContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    Remove-Item -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Force -ErrorAction Ignore
                }
                "Show"
                {
                    if (-not (Test-Path -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew))
                    {
                        New-Item -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Force
                    }
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Name Data -PropertyType Binary -Value ([byte[]](80,75,5,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)) -Force
                    New-ItemProperty -Path Registry::HKEY_CLASSES_ROOT\.zip\CompressedFolder\ShellNew -Name ItemName -PropertyType ExpandString -Value "@%SystemRoot%\System32\zipfldr.dll,-10194" -Force
                }
            }
        }
        CompressedFolderNewContext -Show
  - id: MultipleInvokeContext
    name: EnableMultipleInvokeContext
    description:
      Enable the "Open", "Print", and "Edit" context menu items for more
      than 15 items selected
    script:
      apply: |-
        function MultipleInvokeContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Enable"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer -Name MultipleInvokePromptMinimum -PropertyType DWord -Value 300 -Force
                }
                "Disable"
                {
                    Remove-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer -Name MultipleInvokePromptMinimum -Force -ErrorAction Ignore
                }
            }
        }
        MultipleInvokeContext -Enable
      revert: |-
        function MultipleInvokeContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable
            )

            switch ($PSCmdlet.ParameterSetName)
            {
                "Enable"
                {
                    New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer -Name MultipleInvokePromptMinimum -PropertyType DWord -Value 300 -Force
                }
                "Disable"
                {
                    Remove-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer -Name MultipleInvokePromptMinimum -Force -ErrorAction Ignore
                }
            }
        }
        MultipleInvokeContext -Disable
  - id: UseStoreOpenWith
    name: HideUseStoreOpenWith
    description:
      Hide the "Look for an app in the Microsoft Store" item in the "Open
      with" dialog
    script:
      apply: |-
        function UseStoreOpenWith
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            # Remove all policies in order to make changes visible in UI
            Remove-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Force -ErrorAction Ignore
            Set-Policy -Scope Computer -Path SOFTWARE\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Type DELETE

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer))
                    {
                        New-Item -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer -Force
                    }
                    New-ItemProperty -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -PropertyType DWord -Value 1 -Force

                    Set-Policy -Scope User -Path Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Type DWORD -Value 1
                }
                "Show"
                {
                    Remove-ItemProperty -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Force -ErrorAction Ignore
                    Set-Policy -Scope User -Path Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Type DELETE
                }
            }
        }
        UseStoreOpenWith -Hide
      revert: |-
        function UseStoreOpenWith
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show
            )

            # Remove all policies in order to make changes visible in UI
            Remove-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Force -ErrorAction Ignore
            Set-Policy -Scope Computer -Path SOFTWARE\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Type DELETE

            switch ($PSCmdlet.ParameterSetName)
            {
                "Hide"
                {
                    if (-not (Test-Path -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer))
                    {
                        New-Item -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer -Force
                    }
                    New-ItemProperty -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -PropertyType DWord -Value 1 -Force

                    Set-Policy -Scope User -Path Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Type DWORD -Value 1
                }
                "Show"
                {
                    Remove-ItemProperty -Path HKCU:\Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Force -ErrorAction Ignore
                    Set-Policy -Scope User -Path Software\Policies\Microsoft\Windows\Explorer -Name NoUseStoreOpenWith -Type DELETE
                }
            }
        }
        UseStoreOpenWith -Show
  - id: OpenWindowsTerminalContext
    name: HideOpenWindowsTerminalContext
    description: Hide the "Open in Windows Terminal" item in the folders context menu
    script:
      apply: |-
        function OpenWindowsTerminalContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide
            )

            if (-not (Get-AppxPackage -Name Microsoft.WindowsTerminal))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -Force -ErrorAction Ignore
                }
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -PropertyType String -Value "" -Force
                }
            }
        }
        OpenWindowsTerminalContext -Hide
      revert: |-
        function OpenWindowsTerminalContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Show"
                )]
                [switch]
                $Show,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Hide"
                )]
                [switch]
                $Hide
            )

            if (-not (Get-AppxPackage -Name Microsoft.WindowsTerminal))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -Force -ErrorAction Ignore

            switch ($PSCmdlet.ParameterSetName)
            {
                "Show"
                {
                    Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -Force -ErrorAction Ignore
                }
                "Hide"
                {
                    if (-not (Test-Path -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"))
                    {
                        New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Force
                    }
                    New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -PropertyType String -Value "" -Force
                }
            }
        }
        OpenWindowsTerminalContext -Show
  - id: OpenWindowsTerminalAdminContext
    name: EnableOpenWindowsTerminalAdminContext
    description: Open Windows Terminal in context menu as administrator by default
    script:
      apply: |-
        function OpenWindowsTerminalAdminContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable
            )

            if (-not (Get-AppxPackage -Name Microsoft.WindowsTerminal))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            if (-not (Test-Path -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json"))
            {
                Start-Process -FilePath wt -PassThru
                Start-Sleep -Seconds 2
                Stop-Process -Name WindowsTerminal -Force -PassThru
            }

            try
            {
                $Terminal = Get-Content -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json" -Encoding UTF8 -Force | ConvertFrom-Json
            }
            catch [System.ArgumentException]
            {
                Write-Warning -Message (($Global:Error.Exception.Message | Select-Object -First 1))
                Write-Error -Message (($Global:Error.Exception.Message | Select-Object -First 1)) -ErrorAction SilentlyContinue

                Invoke-Item -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState"

                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            switch ($PSCmdlet.ParameterSetName)
            {
                "Enable"
                {
                    $Paths = @(
                        "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked",
                        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"
                    )
                    Remove-ItemProperty -Path $Paths -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -ErrorAction Ignore

                    if ($Terminal.profiles.defaults.elevate)
                    {
                        $Terminal.profiles.defaults.elevate = $true
                    }
                    else
                    {
                        $Terminal.profiles.defaults | Add-Member -MemberType NoteProperty -Name elevate -Value $true -Force
                    }
                }
                "Disable"
                {
                    if ($Terminal.profiles.defaults.elevate)
                    {
                        $Terminal.profiles.defaults.elevate = $false
                    }
                    else
                    {
                        $Terminal.profiles.defaults | Add-Member -MemberType NoteProperty -Name elevate -Value $false -Force
                    }
                }
            }

            # Save in UTF-8 with BOM despite JSON must not has the BOM: https://datatracker.ietf.org/doc/html/rfc8259#section-8.1. Unless Terminal profile names which contains non-Latin characters will have "?" instead of titles
            ConvertTo-Json -InputObject $Terminal -Depth 4 | Set-Content -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json" -Encoding UTF8 -Force
        }
        OpenWindowsTerminalAdminContext -Enable
      revert: |-
        function OpenWindowsTerminalAdminContext
        {
            param
            (
                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Enable"
                )]
                [switch]
                $Enable,

                [Parameter(
                    Mandatory = $true,
                    ParameterSetName = "Disable"
                )]
                [switch]
                $Disable
            )

            if (-not (Get-AppxPackage -Name Microsoft.WindowsTerminal))
            {
                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            if (-not (Test-Path -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json"))
            {
                Start-Process -FilePath wt -PassThru
                Start-Sleep -Seconds 2
                Stop-Process -Name WindowsTerminal -Force -PassThru
            }

            try
            {
                $Terminal = Get-Content -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json" -Encoding UTF8 -Force | ConvertFrom-Json
            }
            catch [System.ArgumentException]
            {
                Write-Warning -Message (($Global:Error.Exception.Message | Select-Object -First 1))
                Write-Error -Message (($Global:Error.Exception.Message | Select-Object -First 1)) -ErrorAction SilentlyContinue

                Invoke-Item -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState"

                Write-Information -MessageData "" -InformationAction Continue
                Write-Verbose -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -Verbose
                Write-Error -Message ($Localization.Skipped -f $MyInvocation.Line.Trim()) -ErrorAction SilentlyContinue

                return
            }

            switch ($PSCmdlet.ParameterSetName)
            {
                "Enable"
                {
                    $Paths = @(
                        "HKCU:\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked",
                        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked"
                    )
                    Remove-ItemProperty -Path $Paths -Name "{9F156763-7844-4DC4-B2B1-901F640F5155}" -ErrorAction Ignore

                    if ($Terminal.profiles.defaults.elevate)
                    {
                        $Terminal.profiles.defaults.elevate = $true
                    }
                    else
                    {
                        $Terminal.profiles.defaults | Add-Member -MemberType NoteProperty -Name elevate -Value $true -Force
                    }
                }
                "Disable"
                {
                    if ($Terminal.profiles.defaults.elevate)
                    {
                        $Terminal.profiles.defaults.elevate = $false
                    }
                    else
                    {
                        $Terminal.profiles.defaults | Add-Member -MemberType NoteProperty -Name elevate -Value $false -Force
                    }
                }
            }

            # Save in UTF-8 with BOM despite JSON must not has the BOM: https://datatracker.ietf.org/doc/html/rfc8259#section-8.1. Unless Terminal profile names which contains non-Latin characters will have "?" instead of titles
            ConvertTo-Json -InputObject $Terminal -Depth 4 | Set-Content -Path "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json" -Encoding UTF8 -Force
        }
        OpenWindowsTerminalAdminContext -Disable
