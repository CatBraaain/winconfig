# yaml-language-server: $schema=./schema.json

task_definitions:
  - id: AH
    name: DisableActivityHistory
    description: This erases recent docs, clipboard, and run history.
    registries:
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\System
        name: EnableActivityFeed
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\System
        name: PublishUserActivities
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\System
        name: UploadUserActivities
        type: DWord
        old_value: <NotExist>
        new_value: "0"
  - id: Hiber
    name: DisableHibernation
    description:
      Hibernation is really meant for laptops as it saves what's in memory
      before turning the pc off. It really should never be used, but some people are
      lazy and rely on it. Don't be like Bob. Bob likes hibernation.
    registries:
      - path: HKLM\System\CurrentControlSet\Control\Session Manager\Power
        name: HibernateEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FlyoutMenuSettings
        name: ShowHibernateOption
        type: DWord
        old_value: "1"
        new_value: "0"
    script:
      apply: powercfg.exe /hibernate off
      revert: powercfg.exe /hibernate on
  - id: LaptopHibernation
    name: SetHibernationAsDefault
    description:
      Most modern laptops have connected standby enabled which drains the
      battery, this sets hibernation as default which will not drain the battery. See
      issue https://github.com/ChrisTitusTech/winutil/issues/1399
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Control\Power\PowerSettings\238C9FA8-0AAD-41ED-83F4-97BE242C8F20\7bc4a2f9-d8fc-4469-b07b-33eb785aaca0
        name: Attributes
        type: DWord
        old_value: "1"
        new_value: "2"
      - path: HKLM\SYSTEM\CurrentControlSet\Control\Power\PowerSettings\abfc2519-3608-4c2a-94ea-171b0ed546ab\94ac6d29-73ce-41a6-809f-6363ba21b47e
        name: "Attributes "
        type: DWord
        old_value: "0"
        new_value: "2"
    script:
      apply: |-
        Write-Host "Turn on Hibernation"
        Start-Process -FilePath powercfg -ArgumentList "/hibernate on" -NoNewWindow -Wait

        # Set hibernation as the default action
        Start-Process -FilePath powercfg -ArgumentList "/change standby-timeout-ac 60" -NoNewWindow -Wait
        Start-Process -FilePath powercfg -ArgumentList "/change standby-timeout-dc 60" -NoNewWindow -Wait
        Start-Process -FilePath powercfg -ArgumentList "/change monitor-timeout-ac 10" -NoNewWindow -Wait
        Start-Process -FilePath powercfg -ArgumentList "/change monitor-timeout-dc 1" -NoNewWindow -Wait
      revert: |-
        Write-Host "Turn off Hibernation"
        Start-Process -FilePath powercfg -ArgumentList "/hibernate off" -NoNewWindow -Wait

        # Set standby to default values
        Start-Process -FilePath powercfg -ArgumentList "/change standby-timeout-ac 15" -NoNewWindow -Wait
        Start-Process -FilePath powercfg -ArgumentList "/change standby-timeout-dc 15" -NoNewWindow -Wait
        Start-Process -FilePath powercfg -ArgumentList "/change monitor-timeout-ac 15" -NoNewWindow -Wait
        Start-Process -FilePath powercfg -ArgumentList "/change monitor-timeout-dc 15" -NoNewWindow -Wait
  - id: Home
    name: DisableHomegroup
    description:
      Disables HomeGroup - HomeGroup is a password-protected home networking
      service that lets you share your stuff with other PCs that are currently running
      and connected to your network.
    services:
      - name: HomeGroupListener
        old_startup: Automatic
        new_startup: Manual
      - name: HomeGroupProvider
        old_startup: Automatic
        new_startup: Manual
  - id: Loc
    name: DisableLocationTracking
    description: Disables Location Tracking...DUH!
    registries:
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\location
        name: Value
        type: String
        old_value: Allow
        new_value: Deny
      - path: HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Sensor\Overrides\{BFA794E4-F964-4FDB-90F6-51056BFE4B44}
        name: SensorPermissionState
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SYSTEM\CurrentControlSet\Services\lfsvc\Service\Configuration
        name: Status
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SYSTEM\Maps
        name: AutoUpdateEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
  - id: Services
    name: SetServicesToManual
    description:
      Turns a bunch of system services to manual that don't need to be running
      all the time. This is pretty harmless as if the service is needed, it will simply
      start on demand.
    services:
      - name: AJRouter
        old_startup: Manual
        new_startup: Disabled
      - name: ALG
        old_startup: Manual
        new_startup: Manual
      - name: AppIDSvc
        old_startup: Manual
        new_startup: Manual
      - name: AppMgmt
        old_startup: Manual
        new_startup: Manual
      - name: AppReadiness
        old_startup: Manual
        new_startup: Manual
      - name: AppVClient
        old_startup: Disabled
        new_startup: Disabled
      - name: AppXSvc
        old_startup: Manual
        new_startup: Manual
      - name: Appinfo
        old_startup: Manual
        new_startup: Manual
      - name: AssignedAccessManagerSvc
        old_startup: Manual
        new_startup: Disabled
      - name: AudioEndpointBuilder
        old_startup: Automatic
        new_startup: Automatic
      - name: AudioSrv
        old_startup: Automatic
        new_startup: Automatic
      - name: Audiosrv
        old_startup: Automatic
        new_startup: Automatic
      - name: AxInstSV
        old_startup: Manual
        new_startup: Manual
      - name: BDESVC
        old_startup: Manual
        new_startup: Manual
      - name: BFE
        old_startup: Automatic
        new_startup: Automatic
      - name: BITS
        old_startup: Automatic
        new_startup: AutomaticDelayedStart
      - name: BTAGService
        old_startup: Manual
        new_startup: Manual
      - name: BcastDVRUserService_*
        old_startup: Manual
        new_startup: Manual
      - name: BluetoothUserService_*
        old_startup: Manual
        new_startup: Manual
      - name: BrokerInfrastructure
        old_startup: Automatic
        new_startup: Automatic
      - name: Browser
        old_startup: Manual
        new_startup: Manual
      - name: BthAvctpSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: BthHFSrv
        old_startup: Automatic
        new_startup: Automatic
      - name: CDPSvc
        old_startup: Automatic
        new_startup: Manual
      - name: CDPUserSvc_*
        old_startup: Automatic
        new_startup: Automatic
      - name: COMSysApp
        old_startup: Manual
        new_startup: Manual
      - name: CaptureService_*
        old_startup: Manual
        new_startup: Manual
      - name: CertPropSvc
        old_startup: Manual
        new_startup: Manual
      - name: ClipSVC
        old_startup: Manual
        new_startup: Manual
      - name: ConsentUxUserSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: CoreMessagingRegistrar
        old_startup: Automatic
        new_startup: Automatic
      - name: CredentialEnrollmentManagerUserSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: CryptSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: CscService
        old_startup: Manual
        new_startup: Manual
      - name: DPS
        old_startup: Automatic
        new_startup: Automatic
      - name: DcomLaunch
        old_startup: Automatic
        new_startup: Automatic
      - name: DcpSvc
        old_startup: Manual
        new_startup: Manual
      - name: DevQueryBroker
        old_startup: Manual
        new_startup: Manual
      - name: DeviceAssociationBrokerSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: DeviceAssociationService
        old_startup: Manual
        new_startup: Manual
      - name: DeviceInstall
        old_startup: Manual
        new_startup: Manual
      - name: DevicePickerUserSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: DevicesFlowUserSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: Dhcp
        old_startup: Automatic
        new_startup: Automatic
      - name: DiagTrack
        old_startup: Automatic
        new_startup: Disabled
      - name: DialogBlockingService
        old_startup: Disabled
        new_startup: Disabled
      - name: DispBrokerDesktopSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: DisplayEnhancementService
        old_startup: Manual
        new_startup: Manual
      - name: DmEnrollmentSvc
        old_startup: Manual
        new_startup: Manual
      - name: Dnscache
        old_startup: Automatic
        new_startup: Automatic
      - name: EFS
        old_startup: Manual
        new_startup: Manual
      - name: EapHost
        old_startup: Manual
        new_startup: Manual
      - name: EntAppSvc
        old_startup: Manual
        new_startup: Manual
      - name: EventLog
        old_startup: Automatic
        new_startup: Automatic
      - name: EventSystem
        old_startup: Automatic
        new_startup: Automatic
      - name: FDResPub
        old_startup: Manual
        new_startup: Manual
      - name: Fax
        old_startup: Manual
        new_startup: Manual
      - name: FontCache
        old_startup: Automatic
        new_startup: Automatic
      - name: FrameServer
        old_startup: Manual
        new_startup: Manual
      - name: FrameServerMonitor
        old_startup: Manual
        new_startup: Manual
      - name: GraphicsPerfSvc
        old_startup: Manual
        new_startup: Manual
      - name: HomeGroupListener
        old_startup: Manual
        new_startup: Manual
      - name: HomeGroupProvider
        old_startup: Manual
        new_startup: Manual
      - name: HvHost
        old_startup: Manual
        new_startup: Manual
      - name: IEEtwCollectorService
        old_startup: Manual
        new_startup: Manual
      - name: IKEEXT
        old_startup: Manual
        new_startup: Manual
      - name: InstallService
        old_startup: Manual
        new_startup: Manual
      - name: InventorySvc
        old_startup: Manual
        new_startup: Manual
      - name: IpxlatCfgSvc
        old_startup: Manual
        new_startup: Manual
      - name: KeyIso
        old_startup: Automatic
        new_startup: Automatic
      - name: KtmRm
        old_startup: Manual
        new_startup: Manual
      - name: LSM
        old_startup: Automatic
        new_startup: Automatic
      - name: LanmanServer
        old_startup: Automatic
        new_startup: Automatic
      - name: LanmanWorkstation
        old_startup: Automatic
        new_startup: Automatic
      - name: LicenseManager
        old_startup: Manual
        new_startup: Manual
      - name: LxpSvc
        old_startup: Manual
        new_startup: Manual
      - name: MSDTC
        old_startup: Manual
        new_startup: Manual
      - name: MSiSCSI
        old_startup: Manual
        new_startup: Manual
      - name: MapsBroker
        old_startup: Automatic
        new_startup: AutomaticDelayedStart
      - name: McpManagementService
        old_startup: Manual
        new_startup: Manual
      - name: MessagingService_*
        old_startup: Manual
        new_startup: Manual
      - name: MicrosoftEdgeElevationService
        old_startup: Manual
        new_startup: Manual
      - name: MixedRealityOpenXRSvc
        old_startup: Manual
        new_startup: Manual
      - name: MpsSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: MsKeyboardFilter
        old_startup: Disabled
        new_startup: Manual
      - name: NPSMSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: NaturalAuthentication
        old_startup: Manual
        new_startup: Manual
      - name: NcaSvc
        old_startup: Manual
        new_startup: Manual
      - name: NcbService
        old_startup: Manual
        new_startup: Manual
      - name: NcdAutoSetup
        old_startup: Manual
        new_startup: Manual
      - name: NetSetupSvc
        old_startup: Manual
        new_startup: Manual
      - name: NetTcpPortSharing
        old_startup: Disabled
        new_startup: Disabled
      - name: Netlogon
        old_startup: Automatic
        new_startup: Automatic
      - name: Netman
        old_startup: Manual
        new_startup: Manual
      - name: NgcCtnrSvc
        old_startup: Manual
        new_startup: Manual
      - name: NgcSvc
        old_startup: Manual
        new_startup: Manual
      - name: NlaSvc
        old_startup: Manual
        new_startup: Manual
      - name: OneSyncSvc_*
        old_startup: Automatic
        new_startup: Automatic
      - name: P9RdrService_*
        old_startup: Manual
        new_startup: Manual
      - name: PNRPAutoReg
        old_startup: Manual
        new_startup: Manual
      - name: PNRPsvc
        old_startup: Manual
        new_startup: Manual
      - name: PcaSvc
        old_startup: Automatic
        new_startup: Manual
      - name: PeerDistSvc
        old_startup: Manual
        new_startup: Manual
      - name: PenService_*
        old_startup: Manual
        new_startup: Manual
      - name: PerfHost
        old_startup: Manual
        new_startup: Manual
      - name: PhoneSvc
        old_startup: Manual
        new_startup: Manual
      - name: PimIndexMaintenanceSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: PlugPlay
        old_startup: Manual
        new_startup: Manual
      - name: PolicyAgent
        old_startup: Manual
        new_startup: Manual
      - name: Power
        old_startup: Automatic
        new_startup: Automatic
      - name: PrintNotify
        old_startup: Manual
        new_startup: Manual
      - name: PrintWorkflowUserSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: ProfSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: PushToInstall
        old_startup: Manual
        new_startup: Manual
      - name: QWAVE
        old_startup: Manual
        new_startup: Manual
      - name: RasAuto
        old_startup: Manual
        new_startup: Manual
      - name: RasMan
        old_startup: Manual
        new_startup: Manual
      - name: RemoteAccess
        old_startup: Disabled
        new_startup: Disabled
      - name: RemoteRegistry
        old_startup: Disabled
        new_startup: Disabled
      - name: RetailDemo
        old_startup: Manual
        new_startup: Manual
      - name: RmSvc
        old_startup: Manual
        new_startup: Manual
      - name: RpcEptMapper
        old_startup: Automatic
        new_startup: Automatic
      - name: RpcLocator
        old_startup: Manual
        new_startup: Manual
      - name: RpcSs
        old_startup: Automatic
        new_startup: Automatic
      - name: SCPolicySvc
        old_startup: Manual
        new_startup: Manual
      - name: SCardSvr
        old_startup: Manual
        new_startup: Manual
      - name: SDRSVC
        old_startup: Manual
        new_startup: Manual
      - name: SEMgrSvc
        old_startup: Manual
        new_startup: Manual
      - name: SENS
        old_startup: Automatic
        new_startup: Automatic
      - name: SNMPTRAP
        old_startup: Manual
        new_startup: Manual
      - name: SNMPTrap
        old_startup: Manual
        new_startup: Manual
      - name: SSDPSRV
        old_startup: Manual
        new_startup: Manual
      - name: SamSs
        old_startup: Automatic
        new_startup: Automatic
      - name: ScDeviceEnum
        old_startup: Manual
        new_startup: Manual
      - name: Schedule
        old_startup: Automatic
        new_startup: Automatic
      - name: SecurityHealthService
        old_startup: Manual
        new_startup: Manual
      - name: Sense
        old_startup: Manual
        new_startup: Manual
      - name: SensorDataService
        old_startup: Manual
        new_startup: Manual
      - name: SensorService
        old_startup: Manual
        new_startup: Manual
      - name: SensrSvc
        old_startup: Manual
        new_startup: Manual
      - name: SessionEnv
        old_startup: Manual
        new_startup: Manual
      - name: SharedAccess
        old_startup: Manual
        new_startup: Manual
      - name: SharedRealitySvc
        old_startup: Manual
        new_startup: Manual
      - name: ShellHWDetection
        old_startup: Automatic
        new_startup: Automatic
      - name: SmsRouter
        old_startup: Manual
        new_startup: Manual
      - name: Spooler
        old_startup: Automatic
        new_startup: Automatic
      - name: SstpSvc
        old_startup: Manual
        new_startup: Manual
      - name: StiSvc
        old_startup: Manual
        new_startup: Manual
      - name: StorSvc
        old_startup: Automatic
        new_startup: Manual
      - name: SysMain
        old_startup: Automatic
        new_startup: Automatic
      - name: SystemEventsBroker
        old_startup: Automatic
        new_startup: Automatic
      - name: TabletInputService
        old_startup: Manual
        new_startup: Manual
      - name: TapiSrv
        old_startup: Manual
        new_startup: Manual
      - name: TermService
        old_startup: Automatic
        new_startup: Automatic
      - name: Themes
        old_startup: Automatic
        new_startup: Automatic
      - name: TieringEngineService
        old_startup: Manual
        new_startup: Manual
      - name: TimeBroker
        old_startup: Manual
        new_startup: Manual
      - name: TimeBrokerSvc
        old_startup: Manual
        new_startup: Manual
      - name: TokenBroker
        old_startup: Manual
        new_startup: Manual
      - name: TrkWks
        old_startup: Automatic
        new_startup: Automatic
      - name: TroubleshootingSvc
        old_startup: Manual
        new_startup: Manual
      - name: TrustedInstaller
        old_startup: Manual
        new_startup: Manual
      - name: UI0Detect
        old_startup: Manual
        new_startup: Manual
      - name: UdkUserSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: UevAgentService
        old_startup: Disabled
        new_startup: Disabled
      - name: UmRdpService
        old_startup: Manual
        new_startup: Manual
      - name: UnistoreSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: UserDataSvc_*
        old_startup: Manual
        new_startup: Manual
      - name: UserManager
        old_startup: Automatic
        new_startup: Automatic
      - name: UsoSvc
        old_startup: Automatic
        new_startup: Manual
      - name: VGAuthService
        old_startup: Automatic
        new_startup: Automatic
      - name: VMTools
        old_startup: Automatic
        new_startup: Automatic
      - name: VSS
        old_startup: Manual
        new_startup: Manual
      - name: VacSvc
        old_startup: Manual
        new_startup: Manual
      - name: VaultSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: W32Time
        old_startup: Manual
        new_startup: Manual
      - name: WEPHOSTSVC
        old_startup: Manual
        new_startup: Manual
      - name: WFDSConMgrSvc
        old_startup: Manual
        new_startup: Manual
      - name: WMPNetworkSvc
        old_startup: Manual
        new_startup: Manual
      - name: WManSvc
        old_startup: Manual
        new_startup: Manual
      - name: WPDBusEnum
        old_startup: Manual
        new_startup: Manual
      - name: WSService
        old_startup: Manual
        new_startup: Manual
      - name: WSearch
        old_startup: Automatic
        new_startup: AutomaticDelayedStart
      - name: WaaSMedicSvc
        old_startup: Manual
        new_startup: Manual
      - name: WalletService
        old_startup: Manual
        new_startup: Manual
      - name: WarpJITSvc
        old_startup: Manual
        new_startup: Manual
      - name: WbioSrvc
        old_startup: Manual
        new_startup: Manual
      - name: Wcmsvc
        old_startup: Automatic
        new_startup: Automatic
      - name: WcsPlugInService
        old_startup: Manual
        new_startup: Manual
      - name: WdNisSvc
        old_startup: Manual
        new_startup: Manual
      - name: WdiServiceHost
        old_startup: Manual
        new_startup: Manual
      - name: WdiSystemHost
        old_startup: Manual
        new_startup: Manual
      - name: WebClient
        old_startup: Manual
        new_startup: Manual
      - name: Wecsvc
        old_startup: Manual
        new_startup: Manual
      - name: WerSvc
        old_startup: Manual
        new_startup: Manual
      - name: WiaRpc
        old_startup: Manual
        new_startup: Manual
      - name: WinDefend
        old_startup: Automatic
        new_startup: Automatic
      - name: WinHttpAutoProxySvc
        old_startup: Manual
        new_startup: Manual
      - name: WinRM
        old_startup: Manual
        new_startup: Manual
      - name: Winmgmt
        old_startup: Automatic
        new_startup: Automatic
      - name: WlanSvc
        old_startup: Automatic
        new_startup: Automatic
      - name: WpcMonSvc
        old_startup: Manual
        new_startup: Manual
      - name: WpnService
        old_startup: Automatic
        new_startup: Manual
      - name: WpnUserService_*
        old_startup: Automatic
        new_startup: Automatic
      - name: XblAuthManager
        old_startup: Manual
        new_startup: Manual
      - name: XblGameSave
        old_startup: Manual
        new_startup: Manual
      - name: XboxGipSvc
        old_startup: Manual
        new_startup: Manual
      - name: XboxNetApiSvc
        old_startup: Manual
        new_startup: Manual
      - name: autotimesvc
        old_startup: Manual
        new_startup: Manual
      - name: bthserv
        old_startup: Manual
        new_startup: Manual
      - name: camsvc
        old_startup: Manual
        new_startup: Manual
      - name: cbdhsvc_*
        old_startup: Automatic
        new_startup: Manual
      - name: cloudidsvc
        old_startup: Manual
        new_startup: Manual
      - name: dcsvc
        old_startup: Manual
        new_startup: Manual
      - name: defragsvc
        old_startup: Manual
        new_startup: Manual
      - name: diagnosticshub.standardcollector.service
        old_startup: Manual
        new_startup: Manual
      - name: diagsvc
        old_startup: Manual
        new_startup: Manual
      - name: dmwappushservice
        old_startup: Manual
        new_startup: Manual
      - name: dot3svc
        old_startup: Manual
        new_startup: Manual
      - name: edgeupdate
        old_startup: Automatic
        new_startup: Manual
      - name: edgeupdatem
        old_startup: Manual
        new_startup: Manual
      - name: embeddedmode
        old_startup: Manual
        new_startup: Manual
      - name: fdPHost
        old_startup: Manual
        new_startup: Manual
      - name: fhsvc
        old_startup: Manual
        new_startup: Manual
      - name: gpsvc
        old_startup: Automatic
        new_startup: Automatic
      - name: hidserv
        old_startup: Manual
        new_startup: Manual
      - name: icssvc
        old_startup: Manual
        new_startup: Manual
      - name: iphlpsvc
        old_startup: Automatic
        new_startup: Automatic
      - name: lfsvc
        old_startup: Manual
        new_startup: Manual
      - name: lltdsvc
        old_startup: Manual
        new_startup: Manual
      - name: lmhosts
        old_startup: Manual
        new_startup: Manual
      - name: mpssvc
        old_startup: Automatic
        new_startup: Automatic
      - name: msiserver
        old_startup: Manual
        new_startup: Manual
      - name: netprofm
        old_startup: Manual
        new_startup: Manual
      - name: nsi
        old_startup: Automatic
        new_startup: Automatic
      - name: p2pimsvc
        old_startup: Manual
        new_startup: Manual
      - name: p2psvc
        old_startup: Manual
        new_startup: Manual
      - name: perceptionsimulation
        old_startup: Manual
        new_startup: Manual
      - name: pla
        old_startup: Manual
        new_startup: Manual
      - name: seclogon
        old_startup: Manual
        new_startup: Manual
      - name: shpamsvc
        old_startup: Disabled
        new_startup: Disabled
      - name: smphost
        old_startup: Manual
        new_startup: Manual
      - name: spectrum
        old_startup: Manual
        new_startup: Manual
      - name: sppsvc
        old_startup: Automatic
        new_startup: AutomaticDelayedStart
      - name: ssh-agent
        old_startup: Disabled
        new_startup: Disabled
      - name: svsvc
        old_startup: Manual
        new_startup: Manual
      - name: swprv
        old_startup: Manual
        new_startup: Manual
      - name: tiledatamodelsvc
        old_startup: Automatic
        new_startup: Automatic
      - name: tzautoupdate
        old_startup: Disabled
        new_startup: Disabled
      - name: uhssvc
        old_startup: Disabled
        new_startup: Disabled
      - name: upnphost
        old_startup: Manual
        new_startup: Manual
      - name: vds
        old_startup: Manual
        new_startup: Manual
      - name: vm3dservice
        old_startup: Automatic
        new_startup: Manual
      - name: vmicguestinterface
        old_startup: Manual
        new_startup: Manual
      - name: vmicheartbeat
        old_startup: Manual
        new_startup: Manual
      - name: vmickvpexchange
        old_startup: Manual
        new_startup: Manual
      - name: vmicrdv
        old_startup: Manual
        new_startup: Manual
      - name: vmicshutdown
        old_startup: Manual
        new_startup: Manual
      - name: vmictimesync
        old_startup: Manual
        new_startup: Manual
      - name: vmicvmsession
        old_startup: Manual
        new_startup: Manual
      - name: vmicvss
        old_startup: Manual
        new_startup: Manual
      - name: vmvss
        old_startup: Manual
        new_startup: Manual
      - name: wbengine
        old_startup: Manual
        new_startup: Manual
      - name: wcncsvc
        old_startup: Manual
        new_startup: Manual
      - name: webthreatdefsvc
        old_startup: Manual
        new_startup: Manual
      - name: webthreatdefusersvc_*
        old_startup: Automatic
        new_startup: Automatic
      - name: wercplsupport
        old_startup: Manual
        new_startup: Manual
      - name: wisvc
        old_startup: Manual
        new_startup: Manual
      - name: wlidsvc
        old_startup: Manual
        new_startup: Manual
      - name: wlpasvc
        old_startup: Manual
        new_startup: Manual
      - name: wmiApSrv
        old_startup: Manual
        new_startup: Manual
      - name: workfolderssvc
        old_startup: Manual
        new_startup: Manual
      - name: wscsvc
        old_startup: Automatic
        new_startup: AutomaticDelayedStart
      - name: wuauserv
        old_startup: Manual
        new_startup: Manual
      - name: wudfsvc
        old_startup: Manual
        new_startup: Manual
  - id: BraveDebloat
    name: DebloatBrave
    description:
      Disables various annoyances like Brave Rewards,Leo AI,Crypto Wallet
      and VPN
    registries:
      - path: HKLM\SOFTWARE\Policies\BraveSoftware\Brave
        name: BraveRewardsDisabled
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\BraveSoftware\Brave
        name: BraveWalletDisabled
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\BraveSoftware\Brave
        name: BraveVPNDisabled
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\BraveSoftware\Brave
        name: BraveAIChatEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
  - id: EdgeDebloat
    name: DebloatEdge
    description:
      Disables various telemetry options, popups, and other annoyances in
      Edge.
    registries:
      - path: HKLM\SOFTWARE\Policies\Microsoft\EdgeUpdate
        name: CreateDesktopShortcutDefault
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: PersonalizationReportingEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: ShowRecommendationsEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: HideFirstRunExperience
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: UserFeedbackAllowed
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: ConfigureDoNotTrack
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: AlternateErrorPagesEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: EdgeCollectionsEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: EdgeShoppingAssistantEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: MicrosoftEdgeInsiderPromotionEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: ShowMicrosoftRewards
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: WebWidgetAllowed
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: DiagnosticData
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: EdgeAssetDeliveryServiceEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: CryptoWalletEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Edge
        name: WalletDonationEnabled
        type: DWord
        old_value: <NotExist>
        new_value: "0"
  - id: ConsumerFeatures
    name: DisableConsumerFeatures
    description:
      Windows 10 will not automatically install any games, third-party apps,
      or application links from the Windows Store for the signed-in user. Some default
      Apps will be inaccessible (eg. Phone Link)
    registries:
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\CloudContent
        name: DisableWindowsConsumerFeatures
        type: DWord
        old_value: <NotExist>
        new_value: "1"
  - id: Tele
    name: DisableTelemetry
    description:
      "Disables Microsoft Telemetry. Note: This will lock many Edge Browser
      settings. Microsoft spies heavily on you when using the Edge browser."
    registries:
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection
        name: AllowTelemetry
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\DataCollection
        name: AllowTelemetry
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: ContentDeliveryAllowed
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: OemPreInstalledAppsEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: PreInstalledAppsEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: PreInstalledAppsEverEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: SilentInstalledAppsEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: SubscribedContent-338387Enabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: SubscribedContent-338388Enabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: SubscribedContent-338389Enabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: SubscribedContent-353698Enabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager
        name: SystemPaneSuggestionsEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Siuf\Rules
        name: NumberOfSIUFInPeriod
        type: DWord
        old_value: "0"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Siuf\Rules
        name: PeriodInNanoSeconds
        type: QWord
        old_value: <NotExist>
        new_value: <NotExist>
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\DataCollection
        name: DoNotShowFeedbackNotifications
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKCU\SOFTWARE\Policies\Microsoft\Windows\CloudContent
        name: DisableTailoredExperiencesWithDiagnosticData
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\AdvertisingInfo
        name: DisabledByGroupPolicy
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Microsoft\Windows\Windows Error Reporting
        name: Disabled
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DeliveryOptimization\Config
        name: DODownloadMode
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization
        name: DODownloadMode
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SYSTEM\CurrentControlSet\Control\Remote Assistance
        name: fAllowToGetHelp
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\OperationStatusManager
        name: EnthusiastMode
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: ShowTaskViewButton
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\People
        name: PeopleBand
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: LaunchTo
        type: DWord
        old_value: "1"
        new_value: "1"
      - path: HKLM\SYSTEM\CurrentControlSet\Control\FileSystem
        name: LongPathsEnabled
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile
        name: SystemResponsiveness
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile
        name: NetworkThrottlingIndex
        type: DWord
        old_value: "1"
        new_value: "4294967295"
      - path: HKCU\Control Panel\Desktop
        name: AutoEndTasks
        type: DWord
        old_value: "1"
        new_value: "1"
      - path: HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management
        name: ClearPageFileAtShutdown
        type: DWord
        old_value: "0"
        new_value: "0"
      - path: HKLM\SYSTEM\ControlSet001\Services\Ndu
        name: Start
        type: DWord
        old_value: "1"
        new_value: "2"
      - path: HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
        name: IRPStackSize
        type: DWord
        old_value: "20"
        new_value: "30"
      - path: HKCU\SOFTWARE\Policies\Microsoft\Windows\Windows Feeds
        name: EnableFeeds
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Feeds
        name: ShellFeedsTaskbarViewMode
        type: DWord
        old_value: "1"
        new_value: "2"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer
        name: HideSCAMeetNow
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\UserProfileEngagement
        name: ScoobeSystemSettingEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
    scheduled_tasks:
      - full_path: Microsoft\Windows\Application Experience\Microsoft Compatibility Appraiser
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Application Experience\ProgramDataUpdater
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Autochk\Proxy
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Customer Experience Improvement Program\Consolidator
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Customer Experience Improvement Program\UsbCeip
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\DiskDiagnostic\Microsoft-Windows-DiskDiagnosticDataCollector
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Feedback\Siuf\DmClient
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Feedback\Siuf\DmClientOnScenarioDownload
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Windows Error Reporting\QueueReporting
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Application Experience\MareBackup
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Application Experience\StartupAppTask
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Application Experience\PcaPatchDbTask
        old_state: Enabled
        new_state: Disabled
      - full_path: Microsoft\Windows\Maps\MapsUpdateTask
        old_state: Enabled
        new_state: Disabled
    script:
      apply: |-
        bcdedit /set `{current`} bootmenupolicy Legacy | Out-Null
          If ((get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion" -Name CurrentBuild).CurrentBuild -lt 22557) {
              $taskmgr = Start-Process -WindowStyle Hidden -FilePath taskmgr.exe -PassThru
              Do {
                  Start-Sleep -Milliseconds 100
                  $preferences = Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\TaskManager" -Name "Preferences" -ErrorAction SilentlyContinue
              } Until ($preferences)
              Stop-Process $taskmgr
              $preferences.Preferences[28] = 0
              Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\TaskManager" -Name "Preferences" -Type Binary -Value $preferences.Preferences
          }
          Remove-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace\{0DB7E03F-FC29-4DC6-9020-FF41B59E513A}" -Recurse -ErrorAction SilentlyContinue

          # Fix Managed by your organization in Edge if regustry path exists then remove it

          If (Test-Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge") {
              Remove-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Edge" -Recurse -ErrorAction SilentlyContinue
          }

          # Group svchost.exe processes
          $ram = (Get-CimInstance -ClassName Win32_PhysicalMemory | Measure-Object -Property Capacity -Sum).Sum / 1kb
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control" -Name "SvcHostSplitThresholdInKB" -Type DWord -Value $ram -Force

          $autoLoggerDir = "$env:PROGRAMDATA\Microsoft\Diagnosis\ETLLogs\AutoLogger"
          If (Test-Path "$autoLoggerDir\AutoLogger-Diagtrack-Listener.etl") {
              Remove-Item "$autoLoggerDir\AutoLogger-Diagtrack-Listener.etl"
          }
          icacls $autoLoggerDir /deny SYSTEM:`(OI`)`(CI`)F | Out-Null

          # Disable Defender Auto Sample Submission
          Set-MpPreference -SubmitSamplesConsent 2 -ErrorAction SilentlyContinue | Out-Null
      revert: null
  - id: Wifi
    name: DisableWiFiSense
    description:
      Wi-Fi Sense is a spying service that phones home all nearby scanned
      Wi-Fi networks and your current geographic location.
    registries:
      - path: HKLM\Software\Microsoft\PolicyManager\default\WiFi\AllowWiFiHotSpotReporting
        name: Value
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\Software\Microsoft\PolicyManager\default\WiFi\AllowAutoConnectToWiFiSenseHotspots
        name: Value
        type: DWord
        old_value: "1"
        new_value: "0"
  - id: DisableEdge
    name: DisableEdge
    description:
      Disables Microsoft Edge via the registry and prevents scheduled tasks
      from running Edge updates.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun
        name: DisableEdge
        type: String
        old_value: <NotExist>
        new_value: msedge.exe
      - path: HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer
        name: DisallowRun
        type: DWord
        old_value: <NotExist>
        new_value: "1"
    script:
      apply:
        Get-ScheduledTask | Where-Object { $_.TaskName -like '*MicrosoftEdgeUpdate*'
        } | Disable-ScheduledTask
      revert:
        Get-ScheduledTask | Where-Object { $_.TaskName -like '*MicrosoftEdgeUpdate*'
        } | Enable-ScheduledTask
  - id: UTC
    name: SetTimeToUtc
    description:
      Essential for computers that are dual booting. Fixes the time sync
      with Linux Systems.
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation
        name: RealTimeIsUniversal
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: RemoveHome
    name: RemoveHomeFromExplorer
    description: Removes the Home from Explorer and sets This PC as default
    script:
      apply: |-
        REG DELETE "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\{f874310e-b6b7-47dc-bc84-b9e6b38f5903}" /f
        REG ADD "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /f /v "LaunchTo" /t REG_DWORD /d "1"
      revert: |-
        REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\{f874310e-b6b7-47dc-bc84-b9e6b38f5903}" /f /ve /t REG_SZ /d "CLSID_MSGraphHomeFolder"
        REG DELETE "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /f /v "LaunchTo"
  - id: RemoveGallery
    name: RemoveGalleryFromExplorer
    description: Removes the Gallery from Explorer and sets This PC as default
    script:
      apply: |-
        REG DELETE "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\{e88865ea-0e1c-4e20-9aa6-edcd0212c87c}" /f
        REG ADD "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /f /v "LaunchTo" /t REG_DWORD /d "1"
      revert: |-
        REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\{e88865ea-0e1c-4e20-9aa6-edcd0212c87c}" /f /ve /t REG_SZ /d "{e88865ea-0e1c-4e20-9aa6-edcd0212c87c}"
        REG DELETE "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /f /v "LaunchTo"
  - id: Display
    name: SetDisplayForPerformance
    description:
      Sets the system preferences to performance. You can do this manually
      with sysdm.cpl as well.
    registries:
      - path: HKCU\Control Panel\Desktop
        name: DragFullWindows
        type: String
        old_value: "1"
        new_value: "0"
      - path: HKCU\Control Panel\Desktop
        name: MenuShowDelay
        type: String
        old_value: "400"
        new_value: "200"
      - path: HKCU\Control Panel\Desktop\WindowMetrics
        name: MinAnimate
        type: String
        old_value: "1"
        new_value: "0"
      - path: HKCU\Control Panel\Keyboard
        name: KeyboardDelay
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: ListviewAlphaSelect
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: ListviewShadow
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: TaskbarAnimations
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects
        name: VisualFXSetting
        type: DWord
        old_value: "1"
        new_value: "3"
      - path: HKCU\Software\Microsoft\Windows\DWM
        name: EnableAeroPeek
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: TaskbarMn
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: TaskbarDa
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: ShowTaskViewButton
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Search
        name: SearchboxTaskbarMode
        type: DWord
        old_value: "1"
        new_value: "0"
    script:
      apply:
        Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "UserPreferencesMask"
        -Type Binary -Value ([byte[]](144,18,3,128,16,0,0,0))
      revert: Remove-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "UserPreferencesMask"
  - id: DeBloat
    name: RemoveAllMsStoreApps
    description:
      USE WITH CAUTION!!!!! This will remove ALL Microsoft store apps other
      than the essentials to make winget work. Games installed by MS Store ARE INCLUDED!
    script:
      apply: |-
        $TeamsPath = [System.IO.Path]::Combine($env:LOCALAPPDATA, 'Microsoft', 'Teams')
          $TeamsUpdateExePath = [System.IO.Path]::Combine($TeamsPath, 'Update.exe')

          Write-Host "Stopping Teams process..."
          Stop-Process -Name "*teams*" -Force -ErrorAction SilentlyContinue

          Write-Host "Uninstalling Teams from AppData\Microsoft\Teams"
          if ([System.IO.File]::Exists($TeamsUpdateExePath)) {
              # Uninstall app
              $proc = Start-Process $TeamsUpdateExePath "-uninstall -s" -PassThru
              $proc.WaitForExit()
          }

          Write-Host "Removing Teams AppxPackage..."
          Get-AppxPackage "*Teams*" | Remove-AppxPackage -ErrorAction SilentlyContinue
          Get-AppxPackage "*Teams*" -AllUsers | Remove-AppxPackage -AllUsers -ErrorAction SilentlyContinue

          Write-Host "Deleting Teams directory"
          if ([System.IO.Directory]::Exists($TeamsPath)) {
              Remove-Item $TeamsPath -Force -Recurse -ErrorAction SilentlyContinue
          }

          Write-Host "Deleting Teams uninstall registry key"
          # Uninstall from Uninstall registry key UninstallString
          $us = (Get-ChildItem -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall, HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall | Get-ItemProperty | Where-Object { $_.DisplayName -like '*Teams*'}).UninstallString
          if ($us.Length -gt 0) {
              $us = ($us.Replace('/I', '/uninstall ') + ' /quiet').Replace('  ', ' ')
              $FilePath = ($us.Substring(0, $us.IndexOf('.exe') + 4).Trim())
              $ProcessArgs = ($us.Substring($us.IndexOf('.exe') + 5).Trim().replace('  ', ' '))
              $proc = Start-Process -FilePath $FilePath -Args $ProcessArgs -PassThru
              $proc.WaitForExit()
          }
      revert: null
  - id: RestorePoint
    name: CreateRestorePoint
    description:
      Creates a restore point at runtime in case a revert is needed from
      WinUtil modifications
    script:
      apply: |-
        # Check if System Restore is enabled for the main drive
          try {
              # Try getting restore points to check if System Restore is enabled
              Enable-ComputerRestore -Drive "$env:SystemDrive"
          } catch {
              Write-Host "An error occurred while enabling System Restore: $_"
          }

          # Check if the SystemRestorePointCreationFrequency value exists
          $exists = Get-ItemProperty -path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" -Name "SystemRestorePointCreationFrequency" -ErrorAction SilentlyContinue
          if($null -eq $exists) {
              write-host 'Changing system to allow multiple restore points per day'
              Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" -Name "SystemRestorePointCreationFrequency" -Value "0" -Type DWord -Force -ErrorAction Stop | Out-Null
          }

          # Attempt to load the required module for Get-ComputerRestorePoint
          try {
              Import-Module Microsoft.PowerShell.Management -ErrorAction Stop
          } catch {
              Write-Host "Failed to load the Microsoft.PowerShell.Management module: $_"
              return
          }

          # Get all the restore points for the current day
          try {
              $existingRestorePoints = Get-ComputerRestorePoint | Where-Object { $_.CreationTime.Date -eq (Get-Date).Date }
          } catch {
              Write-Host "Failed to retrieve restore points: $_"
              return
          }

          # Check if there is already a restore point created today
          if ($existingRestorePoints.Count -eq 0) {
              $description = "System Restore Point created by WinUtil"

              Checkpoint-Computer -Description $description -RestorePointType "MODIFY_SETTINGS"
              Write-Host -ForegroundColor Green "System Restore Point Created Successfully"
          }
      revert: null
  - id: EndTaskOnTaskbar
    name: EnableEndTaskWithRightClick
    description: Enables option to end task when right clicking a program in the taskbar
    script:
      apply: |-
        $path = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\TaskbarDeveloperSettings"
        $name = "TaskbarEndTask"
        $value = 1

        # Ensure the registry key exists
        if (-not (Test-Path $path)) {
          New-Item -Path $path -Force | Out-Null
        }

        # Set the property, creating it if it doesn't exist
        New-ItemProperty -Path $path -Name $name -PropertyType DWord -Value $value -Force | Out-Null
      revert: |-
        $path = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\TaskbarDeveloperSettings"
        $name = "TaskbarEndTask"
        $value = 0

        # Ensure the registry key exists
        if (-not (Test-Path $path)) {
          New-Item -Path $path -Force | Out-Null
        }

        # Set the property, creating it if it doesn't exist
        New-ItemProperty -Path $path -Name $name -PropertyType DWord -Value $value -Force | Out-Null
  - id: Powershell7
    name: ChangeWindowsTerminalDefault
    description:
      This will edit the config file of the Windows Terminal replacing PowerShell
      5 with PowerShell 7 and installing PS7 if necessary
    script:
      apply: Invoke-WPFTweakPS7 -action "PS7"
      revert: Invoke-WPFTweakPS7 -action "PS5"
  - id: Powershell7Tele
    name: DisablePowershell7Telemetry
    description:
      This will create an Environment Variable called 'POWERSHELL_TELEMETRY_OPTOUT'
      with a value of '1' which will tell Powershell 7 to not send Telemetry Data.
    script:
      apply:
        "[Environment]::SetEnvironmentVariable('POWERSHELL_TELEMETRY_OPTOUT',
        '1', 'Machine')"
      revert:
        "[Environment]::SetEnvironmentVariable('POWERSHELL_TELEMETRY_OPTOUT',
        '', 'Machine')"
  - id: Storage
    name: DisableStorageSense
    description: Storage Sense deletes temp files automatically.
    script:
      apply:
        Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\StorageSense\Parameters\StoragePolicy"
        -Name "01" -Value 0 -Type Dword -Force
      revert:
        Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\StorageSense\Parameters\StoragePolicy"
        -Name "01" -Value 1 -Type Dword -Force
  - id: RemoveCopilot
    name: DisableMicrosoftCopilot
    description: Disables MS Copilot AI built into Windows since 23H2.
    registries:
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot
        name: TurnOffWindowsCopilot
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKCU\Software\Policies\Microsoft\Windows\WindowsCopilot
        name: TurnOffWindowsCopilot
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: ShowCopilotButton
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\Windows\Shell\Copilot
        name: IsCopilotAvailable
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\Windows\Shell\Copilot
        name: CopilotDisabledReason
        type: String
        old_value: <NotExist>
        new_value: IsEnabledForGeographicRegionFailed
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsCopilot
        name: AllowCopilotRuntime
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked
        name: "{CB3B0003-8088-4EDE-8769-8B354AB2FF8C}"
        type: String
        old_value: <NotExist>
        new_value: ""
      - path: HKLM\SOFTWARE\Microsoft\Windows\Shell\Copilot\BingChat
        name: IsUserEligible
        type: DWord
        old_value: <NotExist>
        new_value: "0"
    script:
      apply: |-
        Write-Host "Remove Copilot"
        Get-Package | Where-Object Name -like '*copilot*'
        Get-AppxPackage -AllUsers *Copilot* | Remove-AppxPackage -AllUsers
        Get-AppxProvisionedPackage -Online | Where-Object PackageName -like '*Copilot*' | Remove-AppxProvisionedPackage -Online
        dism /online /remove-package /package-name:Microsoft.Windows.Copilot
      revert: |-
        Write-Host "Install Copilot"
        winget install --name "Microsoft Copilot" --source msstore --accept-package-agreements --accept-source-agreements --silent
  - id: RecallOff
    name: DisableRecall
    description: Turn Recall off
    registries:
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsAI
        name: DisableAIDataAnalysis
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsAI
        name: AllowRecallEnablement
        type: DWord
        old_value: <NotExist>
        new_value: "0"
      - path: HKLM\SYSTEM\CurrentControlSet\Control\CI\Policy
        name: VerifiedAndReputablePolicyState
        type: DWord
        old_value: <NotExist>
        new_value: "0"
    script:
      apply: |-
        Write-Host "Disable Recall"
        DISM /Online /Disable-Feature /FeatureName:Recall /Quiet /NoRestart
        Write-Host "Please restart your computer in order for the changes to be fully applied."
      revert: |-
        Write-Host "Enable Recall"
        DISM /Online /Enable-Feature /FeatureName:Recall /Quiet /NoRestart
        Write-Host "Please restart your computer in order for the changes to be fully applied."
  - id: DisableLMS1
    name: DisableIntelMm
    description:
      Intel LMS service is always listening on all ports and could be a huge
      security risk. There is no need to run LMS on home machines and even in the Enterprise
      there are better solutions.
    script:
      apply: |-
        Write-Host "Kill LMS"
          $serviceName = "LMS"
          Write-Host "Stopping and disabling service: $serviceName"
          Stop-Service -Name $serviceName -Force -ErrorAction SilentlyContinue;
          Set-Service -Name $serviceName -StartupType Disabled -ErrorAction SilentlyContinue;

          Write-Host "Removing service: $serviceName";
          sc.exe delete $serviceName;

          Write-Host "Removing LMS driver packages";
          $lmsDriverPackages = Get-ChildItem -Path "C:\Windows\System32\DriverStore\FileRepository" -Recurse -Filter "lms.inf*";
          foreach ($package in $lmsDriverPackages) {
              Write-Host "Removing driver package: $($package.Name)";
              pnputil /delete-driver $($package.Name) /uninstall /force;
          }
          if ($lmsDriverPackages.Count -eq 0) {
              Write-Host "No LMS driver packages found in the driver store.";
          } else {
              Write-Host "All found LMS driver packages have been removed.";
          }

          Write-Host "Searching and deleting LMS executable files";
          $programFilesDirs = @("C:\Program Files", "C:\Program Files (x86)");
          $lmsFiles = @();
          foreach ($dir in $programFilesDirs) {
              $lmsFiles += Get-ChildItem -Path $dir -Recurse -Filter "LMS.exe" -ErrorAction SilentlyContinue;
          }
          foreach ($file in $lmsFiles) {
              Write-Host "Taking ownership of file: $($file.FullName)";
              & icacls $($file.FullName) /grant Administrators:F /T /C /Q;
              & takeown /F $($file.FullName) /A /R /D Y;
              Write-Host "Deleting file: $($file.FullName)";
              Remove-Item $($file.FullName) -Force -ErrorAction SilentlyContinue;
          }
          if ($lmsFiles.Count -eq 0) {
              Write-Host "No LMS.exe files found in Program Files directories.";
          } else {
              Write-Host "All found LMS.exe files have been deleted.";
          }
          Write-Host 'Intel LMS vPro service has been disabled, removed, and blocked.';
      revert: Write-Host "LMS vPro needs to be redownloaded from intel.com"
  - id: DisableWpbtExecution
    name: DisableWindowsPlatformBinaryTable
    description:
      If enabled then allows your computer vendor to execute a program each
      time it boots. It enables computer vendors to force install anti-theft software,
      software drivers, or a software program conveniently. This could also be a security
      risk.
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Control\Session Manager
        name: DisableWpbtExecution
        type: DWord
        old_value: <NotExist>
        new_value: "1"
  - id: RemoveOnedrive
    name: RemoveOneDrive
    description: Moves OneDrive files to Default Home Folders and Uninstalls it.
    script:
      apply: |-
        $OneDrivePath = $($env:OneDrive)
        Write-Host "Removing OneDrive"

        # Check both traditional and Microsoft Store installations
        $regPath = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Uninstall\OneDriveSetup.exe"
        $msStorePath = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\Applications\*OneDrive*"

        if (Test-Path $regPath) {
            $OneDriveUninstallString = Get-ItemPropertyValue "$regPath" -Name "UninstallString"
            $OneDriveExe, $OneDriveArgs = $OneDriveUninstallString.Split(" ")
            Start-Process -FilePath $OneDriveExe -ArgumentList "$OneDriveArgs /silent" -NoNewWindow -Wait
        } elseif (Test-Path $msStorePath) {
            Write-Host "OneDrive appears to be installed via Microsoft Store" -ForegroundColor Yellow
            # Attempt to uninstall via winget
            Start-Process -FilePath winget -ArgumentList "uninstall -e --purge --accept-source-agreements Microsoft.OneDrive" -NoNewWindow -Wait
        } else {
            Write-Host "OneDrive doesn't seem to be installed" -ForegroundColor Red
            Write-Host "Running cleanup if OneDrive path exists" -ForegroundColor Red
        }

        # Check if OneDrive got Uninstalled (both paths)
        if (Test-Path $OneDrivePath) {
          Write-Host "Copy downloaded Files from the OneDrive Folder to Root UserProfile"
          Start-Process -FilePath powershell -ArgumentList "robocopy '$($OneDrivePath)' '$($env:USERPROFILE.TrimEnd())\' /mov /e /xj" -NoNewWindow -Wait

          Write-Host "Removing OneDrive leftovers"
          Remove-Item -Recurse -Force -ErrorAction SilentlyContinue "$env:localappdata\Microsoft\OneDrive"
          Remove-Item -Recurse -Force -ErrorAction SilentlyContinue "$env:localappdata\OneDrive"
          Remove-Item -Recurse -Force -ErrorAction SilentlyContinue "$env:programdata\Microsoft OneDrive"
          Remove-Item -Recurse -Force -ErrorAction SilentlyContinue "$env:systemdrive\OneDriveTemp"
          reg delete "HKEY_CURRENT_USER\Software\Microsoft\OneDrive" -f
          # check if directory is empty before removing:
          If ((Get-ChildItem "$OneDrivePath" -Recurse | Measure-Object).Count -eq 0) {
              Remove-Item -Recurse -Force -ErrorAction SilentlyContinue "$OneDrivePath"
          }

          Write-Host "Remove Onedrive from Explorer sidebar"
          Set-ItemProperty -Path "HKCR:\CLSID\{018D5C66-4533-4307-9B53-224DE2ED1FE6}" -Name "System.IsPinnedToNameSpaceTree" -Value 0
          Set-ItemProperty -Path "HKCR:\Wow6432Node\CLSID\{018D5C66-4533-4307-9B53-224DE2ED1FE6}" -Name "System.IsPinnedToNameSpaceTree" -Value 0

          Write-Host "Removing run hook for new users"
          reg load "hku\Default" "C:\Users\Default\NTUSER.DAT"
          reg delete "HKEY_USERS\Default\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "OneDriveSetup" /f
          reg unload "hku\Default"

          Write-Host "Removing autostart key"
          reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run" /v "OneDrive" /f

          Write-Host "Removing startmenu entry"
          Remove-Item -Force -ErrorAction SilentlyContinue "$env:userprofile\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\OneDrive.lnk"

          Write-Host "Removing scheduled task"
          Get-ScheduledTask -TaskPath '\' -TaskName 'OneDrive*' -ea SilentlyContinue | Unregister-ScheduledTask -Confirm:$false

          # Add Shell folders restoring default locations
          Write-Host "Shell Fixing"
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "AppData" -Value "$env:userprofile\AppData\Roaming" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Cache" -Value "$env:userprofile\AppData\Local\Microsoft\Windows\INetCache" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Cookies" -Value "$env:userprofile\AppData\Local\Microsoft\Windows\INetCookies" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Favorites" -Value "$env:userprofile\Favorites" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "History" -Value "$env:userprofile\AppData\Local\Microsoft\Windows\History" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Local AppData" -Value "$env:userprofile\AppData\Local" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "My Music" -Value "$env:userprofile\Music" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "My Video" -Value "$env:userprofile\Videos" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "NetHood" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Network Shortcuts" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "PrintHood" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Printer Shortcuts" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Programs" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Start Menu\Programs" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Recent" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Recent" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "SendTo" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\SendTo" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Start Menu" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Start Menu" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Startup" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Templates" -Value "$env:userprofile\AppData\Roaming\Microsoft\Windows\Templates" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "{374DE290-123F-4565-9164-39C4925E467B}" -Value "$env:userprofile\Downloads" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Desktop" -Value "$env:userprofile\Desktop" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "My Pictures" -Value "$env:userprofile\Pictures" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "Personal" -Value "$env:userprofile\Documents" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "{F42EE2D3-909F-4907-8871-4C22FC0BF756}" -Value "$env:userprofile\Documents" -Type ExpandString
          Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" -Name "{0DDD015D-B06C-45D5-8C4C-F59713854639}" -Value "$env:userprofile\Pictures" -Type ExpandString
          Write-Host "Restarting explorer"
          taskkill.exe /F /IM "explorer.exe"
          Start-Process "explorer.exe"

          Write-Host "Waiting for Explorer to complete loading"
          Write-Host "Please Note - The OneDrive folder at $OneDrivePath may still have items in it. You must manually delete it, but all the files should already be copied to the base user folder."
          Write-Host "If there are Files missing afterwards, please Login to Onedrive.com and Download them manually" -ForegroundColor Yellow
          Start-Sleep 5
        } else {
          Write-Host "Nothing to Cleanup with OneDrive" -ForegroundColor Red
        }
      revert: |-
        Write-Host "Install OneDrive"
        Start-Process -FilePath winget -ArgumentList "install -e --accept-source-agreements --accept-package-agreements --silent Microsoft.OneDrive " -NoNewWindow -Wait
  - id: RazerBlock
    name: BlockRazerSoftwareInstalls
    description:
      "Blocks ALL Razer Software installations. The hardware works fine without
      any software. WARNING: this will also block all Windows third-party driver installations."
    registries:
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverSearching
        name: SearchOrderConfig
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Device Installer
        name: DisableCoInstallers
        type: DWord
        old_value: "0"
        new_value: "1"
    script:
      apply: |-
        $RazerPath = "C:\Windows\Installer\Razer"
            Remove-Item $RazerPath -Recurse -Force
            New-Item -Path "C:\Windows\Installer\" -Name "Razer" -ItemType "directory"
            $Acl = Get-Acl $RazerPath
            $Ar = New-Object System.Security.AccessControl.FileSystemAccessRule("NT AUTHORITY\SYSTEM","Write","ContainerInherit,ObjectInherit","None","Deny")
            $Acl.SetAccessRule($Ar)
            Set-Acl $RazerPath $Acl
      revert: |-
        $RazerPath = "C:\Windows\Installer\Razer"
            Remove-Item $RazerPath -Recurse -Force
            New-Item -Path "C:\Windows\Installer\" -Name "Razer" -ItemType "directory"
  - id: DisableNotifications
    name: DisableNotificationTrayCalendar
    description: Disables all Notifications INCLUDING Calendar
    registries:
      - path: HKCU\Software\Policies\Microsoft\Windows\Explorer
        name: DisableNotificationCenter
        type: DWord
        old_value: <NotExist>
        new_value: "1"
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\PushNotifications
        name: ToastEnabled
        type: DWord
        old_value: "1"
        new_value: "0"
  - id: DebloatAdobe
    name: AdobeDebloat
    description: Manages Adobe Services, Adobe Desktop Service, and Acrobat Updates
    services:
      - name: AGSService
        old_startup: Automatic
        new_startup: Disabled
      - name: AGMService
        old_startup: Automatic
        new_startup: Disabled
      - name: AdobeUpdateService
        old_startup: Automatic
        new_startup: Manual
      - name: Adobe Acrobat Update
        old_startup: Automatic
        new_startup: Manual
      - name: Adobe Genuine Monitor Service
        old_startup: Automatic
        new_startup: Disabled
      - name: AdobeARMservice
        old_startup: Automatic
        new_startup: Manual
      - name: Adobe Licensing Console
        old_startup: Automatic
        new_startup: Manual
      - name: CCXProcess
        old_startup: Automatic
        new_startup: Manual
      - name: AdobeIPCBroker
        old_startup: Automatic
        new_startup: Manual
      - name: CoreSync
        old_startup: Automatic
        new_startup: Manual
    script:
      apply: |-
        function CCStopper {
          $path = "C:\Program Files (x86)\Common Files\Adobe\Adobe Desktop Common\ADS\Adobe Desktop Service.exe"

          # Test if the path exists before proceeding
          if (Test-Path $path) {
              Takeown /f $path
              $acl = Get-Acl $path
              $acl.SetOwner([System.Security.Principal.NTAccount]"Administrators")
              $acl | Set-Acl $path

              Rename-Item -Path $path -NewName "Adobe Desktop Service.exe.old" -Force
          } else {
              Write-Host "Adobe Desktop Service is not in the default location."
          }
        }


        function AcrobatUpdates {
          # Editing Acrobat Updates. The last folder before the key is dynamic, therefore using a script.
          # Possible Values for the edited key:
          # 0 = Do not download or install updates automatically
          # 2 = Automatically download updates but let the user choose when to install them
          # 3 = Automatically download and install updates (default value)
          # 4 = Notify the user when an update is available but don't download or install it automatically
          #   = It notifies the user using Windows Notifications. It runs on startup without having to have a Service/Acrobat/Reader running, therefore 0 is the next best thing.

          $rootPath = "HKLM:\SOFTWARE\WOW6432Node\Adobe\Adobe ARM\Legacy\Acrobat"

          # Get all subkeys under the specified root path
          $subKeys = Get-ChildItem -Path $rootPath | Where-Object { $_.PSChildName -like "{*}" }

          # Loop through each subkey
          foreach ($subKey in $subKeys) {
              # Get the full registry path
              $fullPath = Join-Path -Path $rootPath -ChildPath $subKey.PSChildName
              try {
                  Set-ItemProperty -Path $fullPath -Name Mode -Value 0
                  Write-Host "Acrobat Updates have been disabled."
              } catch {
                  Write-Host "Registry Key for changing Acrobat Updates does not exist in $fullPath"
              }
          }
        }

        CCStopper
        AcrobatUpdates
      revert: |-
        function RestoreCCService {
          $originalPath = "C:\Program Files (x86)\Common Files\Adobe\Adobe Desktop Common\ADS\Adobe Desktop Service.exe.old"
          $newPath = "C:\Program Files (x86)\Common Files\Adobe\Adobe Desktop Common\ADS\Adobe Desktop Service.exe"

          if (Test-Path -Path $originalPath) {
              Rename-Item -Path $originalPath -NewName "Adobe Desktop Service.exe" -Force
              Write-Host "Adobe Desktop Service has been restored."
          } else {
              Write-Host "Backup file does not exist. No changes were made."
          }
        }

        function AcrobatUpdates {
          # Default Value:
          # 3 = Automatically download and install updates

          $rootPath = "HKLM:\SOFTWARE\WOW6432Node\Adobe\Adobe ARM\Legacy\Acrobat"

          # Get all subkeys under the specified root path
          $subKeys = Get-ChildItem -Path $rootPath | Where-Object { $_.PSChildName -like "{*}" }

          # Loop through each subkey
          foreach ($subKey in $subKeys) {
              # Get the full registry path
              $fullPath = Join-Path -Path $rootPath -ChildPath $subKey.PSChildName
              try {
                  Set-ItemProperty -Path $fullPath -Name Mode -Value 3
              } catch {
                  Write-Host "Registry Key for changing Acrobat Updates does not exist in $fullPath"
              }
          }
        }

        RestoreCCService
        AcrobatUpdates
  - id: BlockAdobeNet
    name: AdobeNetworkBlock
    description:
      "Reduce user interruptions by selectively blocking connections to Adobe's
      activation and telemetry servers. Credit: Ruddernation-Designs"
    script:
      apply: |-
        # Define the URL of the remote HOSTS file and the local paths
        $remoteHostsUrl = "https://raw.githubusercontent.com/Ruddernation-Designs/Adobe-URL-Block-List/master/hosts"
        $localHostsPath = "C:\Windows\System32\drivers\etc\hosts"
        $tempHostsPath = "C:\Windows\System32\drivers\etc\temp_hosts"

        # Download the remote HOSTS file to a temporary location
        try {
            Invoke-WebRequest -Uri $remoteHostsUrl -OutFile $tempHostsPath
            Write-Output "Downloaded the remote HOSTS file to a temporary location."
        } catch {
            Write-Error "Failed to download the HOSTS file. Error: $_"
        }

        # Check if the AdobeNetBlock has already been started
        try {
            $localHostsContent = Get-Content $localHostsPath -ErrorAction Stop

            # Check if AdobeNetBlock markers exist
            $blockStartExists = $localHostsContent -like "*#AdobeNetBlock-start*"
            if ($blockStartExists) {
                Write-Output "AdobeNetBlock-start already exists. Skipping addition of new block."
            } else {
                # Load the new block from the downloaded file
                $newBlockContent = Get-Content $tempHostsPath -ErrorAction Stop
                $newBlockContent = $newBlockContent | Where-Object { $_ -notmatch "^\s*#" -and $_ -ne "" } # Exclude empty lines and comments
                $newBlockHeader = "#AdobeNetBlock-start"
                $newBlockFooter = "#AdobeNetBlock-end"

                # Combine the contents, ensuring new block is properly formatted
                $combinedContent = $localHostsContent + $newBlockHeader, $newBlockContent, $newBlockFooter | Out-String

                # Write the combined content back to the original HOSTS file
                $combinedContent | Set-Content $localHostsPath -Encoding ASCII
                Write-Output "Successfully added the AdobeNetBlock."
            }
        } catch {
            Write-Error "Error during processing: $_"
        }

        # Clean up temporary file
        Remove-Item $tempHostsPath -ErrorAction Ignore

        # Flush the DNS resolver cache
        try {
            Invoke-Expression "ipconfig /flushdns"
            Write-Output "DNS cache flushed successfully."
        } catch {
            Write-Error "Failed to flush DNS cache. Error: $_"
        }
      revert: |-
        # Define the local path of the HOSTS file
        $localHostsPath = "C:\Windows\System32\drivers\etc\hosts"

        # Load the content of the HOSTS file
        try {
            $hostsContent = Get-Content $localHostsPath -ErrorAction Stop
        } catch {
            Write-Error "Failed to load the HOSTS file. Error: $_"
            return
        }

        # Initialize flags and buffer for new content
        $recording = $true
        $newContent = @()

        # Iterate over each line of the HOSTS file
        foreach ($line in $hostsContent) {
            if ($line -match "#AdobeNetBlock-start") {
                $recording = $false
            }
            if ($recording) {
                $newContent += $line
            }
            if ($line -match "#AdobeNetBlock-end") {
                $recording = $true
            }
        }

        # Write the filtered content back to the HOSTS file
        try {
            $newContent | Set-Content $localHostsPath -Encoding ASCII
            Write-Output "Successfully removed the AdobeNetBlock section from the HOSTS file."
        } catch {
            Write-Error "Failed to write back to the HOSTS file. Error: $_"
        }

        # Flush the DNS resolver cache
        try {
            Invoke-Expression "ipconfig /flushdns"
            Write-Output "DNS cache flushed successfully."
        } catch {
            Write-Error "Failed to flush DNS cache. Error: $_"
        }
  - id: RightClickMenu
    name: SetClassicRightClickMenu
    description:
      Great Windows 11 tweak to bring back good context menus when right
      clicking things in explorer.
    script:
      apply: |-
        New-Item -Path "HKCU:\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}" -Name "InprocServer32" -force -value ""
        Write-Host Restarting explorer.exe ...
        Stop-Process -Name "explorer" -Force
      revert: |-
        Remove-Item -Path "HKCU:\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}" -Recurse -Confirm:$false -Force
        # Restarting Explorer in the Undo Script might not be necessary, as the Registry change without restarting Explorer does work, but just to make sure.
        Write-Host Restarting explorer.exe ...
        Stop-Process -Name "explorer" -Force
  - id: DiskCleanup
    name: RunDiskCleanup
    description: "Runs Disk Cleanup on Drive C: and removes old Windows Updates."
    script:
      apply: |-
        cleanmgr.exe /d C: /VERYLOWDISK
        Dism.exe /online /Cleanup-Image /StartComponentCleanup /ResetBase
      revert: null
  - id: DeleteTempFiles
    name: DeleteTemporaryFiles
    description: Erases TEMP Folders
    script:
      apply: |-
        Get-ChildItem -Path "C:\Windows\Temp" *.* -Recurse | Remove-Item -Force -Recurse
        Get-ChildItem -Path $env:TEMP *.* -Recurse | Remove-Item -Force -Recurse
      revert: null
  - id: DVR
    name: DisableGameDvr
    description:
      GameDVR is a Windows App that is a dependency for some Store Games.
      I've never met someone that likes it, but it's there for the XBOX crowd.
    registries:
      - path: HKCU\System\GameConfigStore
        name: GameDVR_FSEBehavior
        type: DWord
        old_value: "1"
        new_value: "2"
      - path: HKCU\System\GameConfigStore
        name: GameDVR_Enabled
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\System\GameConfigStore
        name: GameDVR_HonorUserFSEBehaviorMode
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKCU\System\GameConfigStore
        name: GameDVR_EFSEFeatureFlags
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\GameDVR
        name: AllowGameDVR
        type: DWord
        old_value: <NotExist>
        new_value: "0"
  - id: IPv46
    name: PreferIPv4OverIPv6
    description:
      To set the IPv4 preference can have latency and security benefits on
      private networks where IPv6 is not configured.
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters
        name: DisabledComponents
        type: DWord
        old_value: "0"
        new_value: "32"
  - id: Teredo
    name: DisableTeredo
    description:
      Teredo network tunneling is a ipv6 feature that can cause additional
      latency, but may cause problems with some games
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters
        name: DisabledComponents
        type: DWord
        old_value: "0"
        new_value: "1"
    script:
      apply: netsh interface teredo set state disabled
      revert: netsh interface teredo set state default
  - id: Disableipsix
    name: DisableIPv6
    description: Disables IPv6.
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters
        name: DisabledComponents
        type: DWord
        old_value: "0"
        new_value: "255"
    script:
      apply: Disable-NetAdapterBinding -Name "*" -ComponentID ms_tcpip6
      revert: Enable-NetAdapterBinding -Name "*" -ComponentID ms_tcpip6
  - id: DisableBGapps
    name: DisableBackgroundApps
    description:
      Disables all Microsoft Store apps from running in the background, which
      has to be done individually since Win11
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications
        name: GlobalUserDisabled
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: DisableFSO
    name: DisableFullscreenOptimizations
    description:
      "Disables FSO in all applications. NOTE: This will disable Color Management
      in Exclusive Fullscreen"
    registries:
      - path: HKCU\System\GameConfigStore
        name: GameDVR_DXGIHonorFSEWindowsCompatible
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: DarkMode
    name: DarkThemeForWindows
    description: Enable/Disable Dark Mode.
    registries:
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Themes\Personalize
        name: AppsUseLightTheme
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Themes\Personalize
        name: SystemUsesLightTheme
        type: DWord
        old_value: "1"
        new_value: "0"
  - id: BingSearch
    name: BingSearchInStartMenu
    description:
      If enable then includes web search results from Bing in your Start
      Menu search.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Search
        name: BingSearchEnabled
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: NumLock
    name: NumLockOnStartup
    description: Toggle the Num Lock key state when your computer starts.
    registries:
      - path: HKU\.Default\Control Panel\Keyboard
        name: InitialKeyboardIndicators
        type: DWord
        old_value: "0"
        new_value: "2"
      - path: HKCU\Control Panel\Keyboard
        name: InitialKeyboardIndicators
        type: DWord
        old_value: "0"
        new_value: "2"
  - id: VerboseLogon
    name: VerboseMessagesDuringLogon
    description:
      Show detailed messages during the login process for troubleshooting
      and diagnostics.
    registries:
      - path: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
        name: VerboseStatus
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: StartMenuRecommendations
    name: RecommendationsInStartMenu
    description:
      "If disabled then you will not see recommendations in the Start Menu.
      | Enables 'iseducationenvironment' | Relogin Required. | WARNING: This will
      also disable Windows Spotlight on your Lock Screen as a side effect."
    registries:
      - path: HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\Start
        name: HideRecommendedSection
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\Education
        name: IsEducationEnvironment
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKLM\SOFTWARE\Policies\Microsoft\Windows\Explorer
        name: HideRecommendedSection
        type: DWord
        old_value: "1"
        new_value: "0"
  - id: HideSettingsHome
    name: RemoveSettingsHomePage
    description: Removes the Home page in the Windows Settings app.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer
        name: SettingsPageVisibility
        type: String
        old_value: show:home
        new_value: hide:home
  - id: SnapWindow
    name: SnapWindow
    description: If enabled you can align windows by dragging them. | Relogin Required
    registries:
      - path: HKCU\Control Panel\Desktop
        name: WindowArrangementActive
        type: String
        old_value: "0"
        new_value: "1"
  - id: SnapFlyout
    name: SnapAssistFlyout
    description: If enabled then Snap preview is disabled when maximize button is hovered.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: EnableSnapAssistFlyout
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: SnapSuggestion
    name: SnapAssistSuggestion
    description:
      If enabled then you will get suggestions to snap other applications
      in the left over spaces.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: SnapAssist
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: MouseAcceleration
    name: MouseAcceleration
    description:
      If Enabled then Cursor movement is affected by the speed of your physical
      mouse movements.
    registries:
      - path: HKCU\Control Panel\Mouse
        name: MouseSpeed
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKCU\Control Panel\Mouse
        name: MouseThreshold1
        type: DWord
        old_value: "0"
        new_value: "6"
      - path: HKCU\Control Panel\Mouse
        name: MouseThreshold2
        type: DWord
        old_value: "0"
        new_value: "10"
  - id: StickyKeys
    name: StickyKeys
    description:
      If Enabled then Sticky Keys is activated - Sticky keys is an accessibility
      feature of some graphical user interfaces which assists users who have physical
      disabilities or help users reduce repetitive strain injury.
    registries:
      - path: HKCU\Control Panel\Accessibility\StickyKeys
        name: Flags
        type: DWord
        old_value: "58"
        new_value: "510"
  - id: NewOutlook
    name: NewOutlook
    description:
      If disabled it removes the toggle for new Outlook, disables the new
      Outlook migration and makes sure the Outlook Application actually uses the old
      Outlook.
    registries:
      - path: HKCU\SOFTWARE\Microsoft\Office\16.0\Outlook\Preferences
        name: UseNewOutlook
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKCU\Software\Microsoft\Office\16.0\Outlook\Options\General
        name: HideNewOutlookToggle
        type: DWord
        old_value: "1"
        new_value: "0"
      - path: HKCU\Software\Policies\Microsoft\Office\16.0\Outlook\Options\General
        name: DoNewOutlookAutoMigration
        type: DWord
        old_value: "0"
        new_value: "0"
      - path: HKCU\Software\Policies\Microsoft\Office\16.0\Outlook\Preferences
        name: NewOutlookMigrationUserSetting
        type: DWord
        old_value: <NotExist>
        new_value: "0"
  - id: MultiplaneOverlay
    name: MultiplaneOverlay
    description:
      Disable the Multiplane Overlay which can sometimes cause issues with
      Graphics Cards.
    registries:
      - path: HKLM\SOFTWARE\Microsoft\Windows\Dwm
        name: OverlayTestMode
        type: DWord
        old_value: <NotExist>
        new_value: "5"
  - id: HiddenFiles
    name: ShowHiddenFiles
    description: If Enabled then Hidden Files will be shown.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: Hidden
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: ShowExt
    name: ShowFileExtensions
    description: If enabled then File extensions (e.g., .txt, .jpg) are visible.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: HideFileExt
        type: DWord
        old_value: "1"
        new_value: "0"
  - id: TaskbarSearch
    name: SearchButtonInTaskbar
    description: If Enabled Search Button will be on the taskbar.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Search
        name: SearchboxTaskbarMode
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: TaskView
    name: TaskViewButtonInTaskbar
    description: If Enabled then Task View Button in Taskbar will be shown.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: ShowTaskViewButton
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: TaskbarWidgets
    name: WidgetsButtonInTaskbar
    description: If Enabled then Widgets Button in Taskbar will be shown.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: TaskbarDa
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: TaskbarAlignment
    name: CenterTaskbarItems
    description:
      "[Windows 11] If Enabled then the Taskbar Items will be shown on the
      Center, otherwise the Taskbar Items will be shown on the Left."
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
        name: TaskbarAl
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: DetailedBSoD
    name: DetailedBSoD
    description:
      If Enabled then you will see a detailed Blue Screen of Death (BSOD)
      with more information.
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Control\CrashControl
        name: DisplayParameters
        type: DWord
        old_value: "0"
        new_value: "1"
      - path: HKLM\SYSTEM\CurrentControlSet\Control\CrashControl
        name: DisableEmoticon
        type: DWord
        old_value: "0"
        new_value: "1"
  - id: S3Sleep
    name: S3Sleep
    description: Toggles between Modern Standby and S3 sleep.
    registries:
      - path: HKLM\SYSTEM\CurrentControlSet\Control\Power
        name: PlatformAoAcOverride
        type: DWord
        old_value: <NotExist>
        new_value: "0"
  - id: DisableExplorerAutoDiscovery
    name: DisableExplorerAutomaticFolderDiscovery
    description:
      Windows Explorer automatically tries to guess the type of the folder
      based on its contents, slowing down the browsing experience.
    script:
      apply: |-
        # Previously detected folders
        $bags = "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\Bags"

        # Folder types lookup table
        $bagMRU = "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\BagMRU"

        # Flush Explorer view database
        Remove-Item -Path $bags -Recurse -Force
        Write-Host "Removed $bags"

        Remove-Item -Path $bagMRU -Recurse -Force
        Write-Host "Removed $bagMRU"

        # Every folder
        $allFolders = "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\Bags\AllFolders\Shell"

        if (!(Test-Path $allFolders)) {
          New-Item -Path $allFolders -Force
          Write-Host "Created $allFolders"
        }

        # Generic view
        New-ItemProperty -Path $allFolders -Name "FolderType" -Value "NotSpecified" -PropertyType String -Force
        Write-Host "Set FolderType to NotSpecified"

        Write-Host Please sign out and back in, or restart your computer to apply the changes!
      revert: |-
        # Previously detected folders
        $bags = "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\Bags"

        # Folder types lookup table
        $bagMRU = "HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\BagMRU"

        # Flush Explorer view database
        Remove-Item -Path $bags -Recurse -Force
        Write-Host "Removed $bags"

        Remove-Item -Path $bagMRU -Recurse -Force
        Write-Host "Removed $bagMRU"

        Write-Host Please sign out and back in, or restart your computer to apply the changes!
  - id: DisableCrossDeviceResume
    name: CrossDeviceResume
    description:
      This tweak controls the Resume function in Windows 11 24H2 and later,
      which allows you to resume an activity from a mobile device and vice-versa.
    registries:
      - path: HKCU\Software\Microsoft\Windows\CurrentVersion\CrossDeviceResume\Configuration
        name: IsResumeAllowed
        type: DWord
        old_value: "0"
        new_value: "1"
